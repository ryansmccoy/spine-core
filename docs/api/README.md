# API Documentation

> Last Updated: 2026-01-04  
> Status: **AUTHORITATIVE**

This directory contains the authoritative API documentation for Market Spine.

---

## Documents

| Document | Purpose |
|----------|---------|
| [00-api-overview.md](00-api-overview.md) | Architecture, terminology, stable contract philosophy |
| [01-data-access-patterns.md](01-data-access-patterns.md) | Query patterns, pagination, response envelopes, error model |
| [02-basic-api-surface.md](02-basic-api-surface.md) | Complete Basic tier endpoint reference |
| [03-intermediate-advanced-full-roadmap.md](03-intermediate-advanced-full-roadmap.md) | API evolution by tier |
| [04-openapi-and-testing-strategy.md](04-openapi-and-testing-strategy.md) | OpenAPI conventions, testing approach |
| [05-contract-clarifications-invariants.md](05-contract-clarifications-invariants.md) | **Hard invariants**, idempotency, dependencies, retention, readiness contracts |

---

## Related Documentation

| Document | Purpose | Relationship |
|----------|---------|--------------|
| [../frontend-backend-integration-map.md](../frontend-backend-integration-map.md) | Frontend client adaptation | Consumes this API spec |
| [../tier-comparison.md](../tier-comparison.md) | Feature matrix across tiers | High-level summary |
| [../../market-spine-basic/README.md](../../market-spine-basic/README.md) | Basic tier setup | Usage examples |

---

## Consolidation Notes

This documentation was created by consolidating and reconciling information from:

### Sources Reviewed

1. **market-spine-basic/src/market_spine/api/** — Actual route implementations
2. **docs/frontend-backend-integration-map.md** — Frontend expectations
3. **docs/tier-comparison.md** — Feature matrix
4. **market-spine-intermediate/src/** — Intermediate tier routes
5. **market-spine-full/src/** — Full tier routes

### Contradictions Found and Resolved

| Issue | Found In | Resolution |
|-------|----------|------------|
| **Route prefix inconsistency** | Various docs referred to `/api/v1/` vs `/v1/` | **Resolved**: Backend uses `/v1/` prefix directly. Frontend proxy adds `/api` if needed. |
| **Capabilities field names** | Frontend expected `has*` boolean fields | **Resolved**: Backend provides raw booleans; frontend derives `has*` fields via `SpineCapabilities` interface. |
| **Execution status values** | Tier comparison showed different states per tier | **Resolved**: Documented in [03-roadmap](03-intermediate-advanced-full-roadmap.md) as intentional evolution. |
| **Data endpoints naming** | Some docs used `dataset`, others `calc` | **Resolved**: Standardized on `calc` for derived data, `dataset` deprecated. |
| **Query response envelope** | Inconsistent between `rows` vs `symbols` | **Resolved**: Basic uses simplified responses; full envelope documented for future. |

### Deprecated Documentation

The following documentation should be considered **superseded** by this API docs set:

| Old Document | Status | Notes |
|--------------|--------|-------|
| Any ad-hoc API notes in README files | Superseded | Refer to this docs/api/ directory |
| Inline route comments for contract details | Supplementary | Code comments are implementation notes, not contract |

---

## How to Update

When changing the API:

1. **Update source code** first (routes, models)
2. **Update the relevant doc** in this directory
3. **Run contract tests** to validate changes
4. **Check OpenAPI** at `/docs` for consistency
5. **Update frontend types** if response shapes change

See [04-openapi-and-testing-strategy.md](04-openapi-and-testing-strategy.md) for the full "Definition of Done" checklist.

---

## OpenAPI Spec

The live OpenAPI spec is generated by FastAPI and available at:

- **Swagger UI**: `http://localhost:8000/docs`
- **ReDoc**: `http://localhost:8000/redoc`
- **Raw JSON**: `http://localhost:8000/openapi.json`

These docs define the *design intent* and *contracts*. The OpenAPI spec is the *implementation truth*.
