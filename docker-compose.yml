# ==============================================================================
# Market Spine - Multi-Tier Docker Compose
# ==============================================================================
#
# This root-level compose file provides an easy way to run the full stack
# (frontend + backend) for any tier. It uses the backend compose as the base
# and adds the frontend automatically.
#
# ==============================================================================
# QUICK START
# ==============================================================================
#
# Basic Tier (SQLite, sync-only):
#   docker compose -f docker-compose.yml -f docker-compose.basic.yml up
#
# Intermediate Tier (PostgreSQL, async jobs):
#   docker compose -f docker-compose.yml -f docker-compose.intermediate.yml up
#
# Full Tier (TimescaleDB, Redis, Celery):
#   docker compose -f docker-compose.yml -f docker-compose.full.yml up
#
# Development mode (any tier):
#   docker compose -f docker-compose.yml -f docker-compose.basic.yml \
#                  -f docker-compose.dev.yml up
#
# ==============================================================================
# PORT ASSIGNMENTS
# ==============================================================================
#
# Root-level integrated stack (docker-compose.yml + tier override):
#   3100 - Frontend (trading-desktop, Docker)
#   8100 - API (all tiers, root compose)
#   5432 - PostgreSQL/TimescaleDB (intermediate/full only)
#   6379 - Redis (full only)
#   9090 - Prometheus (full, monitoring profile)
#   3001 - Grafana (full, monitoring profile)
#
# Standalone tier compose files (market-spine-*/docker-compose.yml):
#   These use different ports to allow running alongside the integrated stack:
#
#   Basic (market-spine-basic/):       API=8010, Frontend=3110
#   Intermediate (market-spine-intermediate/): API=8020, PostgreSQL=5442
#   Advanced (market-spine-advanced/): API=8040, PostgreSQL=5462, Redis=6399
#   Full (market-spine-full/):         API=8030, PostgreSQL=5452, Redis=6389
#
# Ports reserved for LOCAL development (not Docker):
#   3000 - Local Vite/npm dev server (your frontend)
#   5173 - Vite default dev server port
#   8000 - Reserved for other local projects
#
# ==============================================================================
# TIER COMPARISON
# ==============================================================================
#
# | Feature                | Basic | Intermediate | Full   |
# |------------------------|-------|--------------|--------|
# | Pipelines              | ✓     | ✓            | ✓      |
# | Data Queries           | ✓     | ✓            | ✓      |
# | Database               | SQLite| PostgreSQL   | Timescale|
# | Async Jobs             | -     | ✓            | ✓      |
# | Scheduler              | -     | ✓            | ✓      |
# | Job History            | -     | ✓            | ✓      |
# | Incidents              | -     | -            | ✓      |
# | Anomaly Detection      | -     | -            | ✓      |
# | Message Broker         | -     | -            | Redis  |
# | Horizontal Scaling     | -     | -            | ✓      |
#
# ==============================================================================

services:
  # Trading Desktop Frontend - included in all tier configurations
  frontend:
    build:
      context: ./trading-desktop
      dockerfile: Dockerfile
    container_name: trading-desktop
    ports:
      - "3100:8080"
    restart: unless-stopped
    # depends_on is defined in tier-specific override files
